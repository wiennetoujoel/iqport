<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Web site created using create-react-app" />
  <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
  <!-- Add these lines to your index.html file -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>IQPort</title>
</head>

<body>
  <div id="root"></div>
 
  <!--DOM untuk memasukkan JS file ke HTML-->
  <script type="text/javascript" src="./src/Components/Pages/Home.js"></script>
  

  <!--ini untuk grafik-->

  <div>
    <button onclick="getData('PM25')">PM2.5</button>
    <button onclick="getData('PM10')">PM10</button>
    <button onclick="getData('temperatur')">Temperatur</button>
    <button onclick="getData('kelembaban')">Kelembaban</button>
    <button onclick="getData('co')">CO</button>

    <button onclick="setLabels('hourly')">Hourly</button>
    <button onclick="setLabels('daily')">Daily</button>
  </div>
  <canvas id="myChart"></canvas>

  <script>
    let apiUrl = "";
    let chart = null;
    let currentParam = "PM25";
    let currentLabel = "hourly";

    function setLabels(label) {
      currentLabel = label;
      getData(currentParam, currentLabel);
    }

    function getData(param) {
      currentParam = param;
      let yLabel = "";
      let dataUrl = "";

      switch (param) {
        case "PM25":
          yLabel = "PM2.5 (ppm)";
          if (currentLabel === "hourly") {
            dataUrl = "http://34.101.124.69:3300/main/3/PM25/2023-04-05/Andir";
          } else {
            dataUrl = "http://34.101.124.69:3300/main/3/PM25/harian/2023-04-05/Andir";
          }
          break;

        case "PM10":
          yLabel = "PM10 (ppm)";
          if (currentLabel === "hourly") {
            dataUrl = "http://34.101.124.69:3300/main/4/PM10/2023-04-05/Andir";
          } else {
            dataUrl = "http://34.101.124.69:3300/main/4/PM10/harian/2023-04-05/Andir";
          }
          break;

        case "temperatur":
          yLabel = "Temperatur (Â°C)";
          if (currentLabel === "hourly") {
            dataUrl = "http://34.101.124.69:3300/main/2/temperatur/2023-04-05/Andir";
          }
          else {
            dataUrl = "http://34.101.124.69:3300/main/2/temperatur/harian/2023-04-05/Andir";
          }
          break;

        case "kelembaban":
          yLabel = "Kelembaban (%)";
          if (currentLabel === "hourly") {
            dataUrl = "http://34.101.124.69:3300/main/3/kelembapan/2023-04-05/Andir";
          }
          else {
            dataUrl = "http://34.101.124.69:3300/main/3/kelembapan/harian/2023-04-05/Andir";
          }
          break;

        case "co":
          yLabel = "CO (ppm)";
          if (currentLabel === "hourly") {
            dataUrl = "http://34.101.124.69:3300/main/4/CO/2023-04-05/Andir";
          }
          else {
            dataUrl = "http://34.101.124.69:3300/main/4/CO/harian/2023-04-05/Andir";
          }
          break;
      }

      fetch(dataUrl)
        .then(response => response.json())
        .then(data => {
          const labels = [];

          if (currentLabel === "hourly") {
            labels.push(...data.map(d => d.jam));
          } else {
            labels.push(...data.map(d => d.tanggal));
          }

          let yData = [];

          switch (param) {
            case "PM25":
              if (currentLabel === "hourly") {
                yData = data.map(d => d.rata_konsentrasipm25);
              }
              else {
                yData = data.map(d => d.rata_pm25);
              }
              break;

            case "PM10":
              if (currentLabel === "hourly") {
                yData = data.map(d => d.rata_konsentrasi_pm10);
              }
              else {
                yData = data.map(d => d.rata_pm10);
              } 
              break;

            case "temperatur":
              if (currentLabel === "hourly") {
                yData = data.map(d => d.rata_temperatur);
              }
              else {
                yData = data.map(d => d.rata_nilai_temperatur);
              }
              break;

            case "kelembaban":  
              if (currentLabel === "hourly"){
                yData = data.map(d => d.rata_kelembapan);
              }
              else {
                yData = data.map(d => d.rata_nilai_kelembapan);
              }
              break;

            case "co":
              if (currentLabel === "hourly"){
                yData = data.map(d => d.rata_co);
              }
              else{
                yData = data.map(d => d.rata_nilai_co);
              }

          }

          if (chart) {
            chart.destroy();
          }

          chart = new Chart(document.getElementById("myChart"), {
            type: "bar",
            data: {
              labels: labels,
              datasets: [
                {
                  label: currentParam,
                  data: yData,
                  backgroundColor: "rgba(255, 99, 132, 0.2)",
                  borderColor: "rgba(255, 99, 132, 1)",
                  borderWidth: 1
                }
              ]
            },
            options: {
              scales: {
                yAxes: [{
                  scaleLabel: {
                    display: true,
                    labelString: yLabel
                  },
                  ticks: {
                    beginAtZero: true,
                    stepSize: 5
                  }
                }]
              }
            }
          });
        });
    }

    getData(currentParam);
  </script>

<script type="text/javascript" src="./src/Components/Pages/MainGraph.js"></script>

</body>

</html>